<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard LogÃ­stico/Financeiro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'matte-charcoal': '#1a1b20',
                    }
                }
            }
        }
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow: hidden;
            background: #1a1b20;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        .glass-card-strong {
            background: rgba(30, 31, 40, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
        }

        .glow-gold {
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes pulse-glow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .animate-float {
            animation: float 3s ease-in-out infinite;
        }

        .animate-pulse-glow {
            animation: pulse-glow 2s ease-in-out infinite;
        }

        .gradient-text {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .gradient-text-cyan {
            background: linear-gradient(135deg, #00FFFF 0%, #0080FF 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
</head>
<body class="bg-matte-charcoal text-white">
    <div id="root">
        <!-- Loading -->
        <div style="display: flex; align-items: center; justify-content: center; height: 100vh;">
            <div style="text-align: center;">
                <div style="width: 64px; height: 64px; border: 4px solid rgba(255,255,255,0.1); border-top-color: #00FFFF; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 1rem auto;"></div>
                <div style="color: #00FFFF; font-size: 1.25rem; font-weight: 600;">Carregando Dashboard...</div>
            </div>
        </div>
    </div>

    <style>
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>

    <!-- React via CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- PapaParse -->
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    
    <!-- Recharts -->
    <script src="https://cdn.jsdelivr.net/npm/recharts@2.5.0/dist/Recharts.js"></script>

    <!-- App Inline -->
    <script type="text/babel">
        const { useState, useEffect, useCallback, useMemo } = React;
        const { RadialBarChart, RadialBar, PolarAngleAxis, AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } = Recharts;

        // CONFIG
        const DASHBOARD_CONFIG = {
            GOOGLE_SHEETS_CSV_URL: "https://docs.google.com/spreadsheets/d/e/2PACX-1vR_EXAMPLE_KEY/pub?output=csv",
            POLLING_INTERVAL: 30000,
        };

        const MOCK_DATA = [
            { kpi_name: 'Receita Total', value: 21338, trend: 12.5, category: 'financeiro' },
            { kpi_name: 'Custo Operacional', value: 8450, trend: -3.2, category: 'financeiro' },
            { kpi_name: 'Margem de Lucro', value: 60.3, trend: 8.7, category: 'financeiro' },
            { kpi_name: 'ROI', value: 145.2, trend: 15.4, category: 'financeiro' },
            { kpi_name: 'Entregas Realizadas', value: 1485, trend: 22.1, category: 'logistica' },
            { kpi_name: 'Entregas Pendentes', value: 318, trend: -5.3, category: 'logistica' },
            { kpi_name: 'Tempo MÃ©dio Entrega', value: 2.4, trend: -12.5, category: 'logistica' },
            { kpi_name: 'Taxa de Sucesso', value: 97.8, trend: 2.1, category: 'logistica' },
        ];

        const MOCK_HISTORICAL_DATA = [
            { time: '00:00', value: 1125 },
            { time: '04:00', value: 1145 },
            { time: '08:00', value: 1320 },
            { time: '12:00', value: 1280 },
            { time: '16:00', value: 1450 },
            { time: '20:00', value: 1485 },
        ];

        // HOOK
        function useDashboardData() {
            const [data, setData] = useState(MOCK_DATA);
            const [historicalData, setHistoricalData] = useState(MOCK_HISTORICAL_DATA);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);
            const [lastUpdate, setLastUpdate] = useState(new Date());

            const getFinanceData = useCallback(() => data.filter(item => item.category === 'financeiro'), [data]);
            const getLogisticsData = useCallback(() => data.filter(item => item.category === 'logistica'), [data]);
            const getTotalGoal = useCallback(() => 75, []);

            return { data, historicalData, loading, error, lastUpdate, getFinanceData, getLogisticsData, getTotalGoal };
        }

        // KPI CARD
        const KpiCard = ({ kpi_name, value, trend, index }) => {
            const formatValue = (val) => {
                if (typeof val === 'number') {
                    if (val < 100 && (kpi_name.toLowerCase().includes('margin') || kpi_name.toLowerCase().includes('taxa') || kpi_name.toLowerCase().includes('roi'))) {
                        return `${val.toFixed(1)}%`;
                    }
                    if (val > 1000) return `$${val.toLocaleString('pt-BR')}`;
                    return val.toFixed(1);
                }
                return val;
            };

            const trendColor = trend > 0 ? 'text-green-400' : 'text-red-400';
            const trendIcon = trend > 0 ? 'â†‘' : 'â†“';

            return (
                <div className="glass-card-strong rounded-3xl p-6 mb-4 transform transition-all duration-300 hover:scale-105 cursor-pointer"
                     style={{ background: 'linear-gradient(135deg, rgba(147, 51, 234, 0.1) 0%, rgba(30, 31, 40, 0.9) 100%)' }}>
                    <div className="text-gray-400 text-sm font-medium mb-3 uppercase tracking-wider">{kpi_name}</div>
                    <div className="flex items-end justify-between">
                        <div className="text-4xl font-bold gradient-text glow-gold">{formatValue(value)}</div>
                        <div className={`flex items-center gap-1 ${trendColor} font-semibold text-lg`}>
                            <span className="text-2xl">{trendIcon}</span>
                            <span>{Math.abs(trend).toFixed(1)}%</span>
                        </div>
                    </div>
                    <div className="mt-4 h-1 bg-gray-700/50 rounded-full overflow-hidden">
                        <div className="h-full rounded-full transition-all duration-1000"
                             style={{
                                 width: `${Math.min(Math.abs(trend) * 5, 100)}%`,
                                 background: trend > 0 ? 'linear-gradient(90deg, #10B981 0%, #34D399 100%)' : 'linear-gradient(90deg, #EF4444 0%, #F87171 100%)'
                             }} />
                    </div>
                </div>
            );
        };

        // HERO GAUGE
        const HeroGauge = ({ goalPercentage = 75 }) => {
            const data = [
                { name: 'CrÃ­tico', value: Math.min(goalPercentage, 33), fill: '#EF4444' },
                { name: 'AtenÃ§Ã£o', value: Math.min(Math.max(goalPercentage - 33, 0), 33), fill: '#F59E0B' },
                { name: 'Ã“timo', value: Math.max(goalPercentage - 66, 0), fill: '#00FFFF' },
            ];

            return (
                <div className="relative flex flex-col items-center justify-center">
                    <div className="text-center mb-4">
                        <h2 className="text-2xl font-bold gradient-text-cyan tracking-wide uppercase">META GERAL</h2>
                        <div className="text-gray-400 text-sm mt-1">Performance Global</div>
                    </div>
                    <div className="relative w-full" style={{ height: '400px' }}>
                        <ResponsiveContainer width="100%" height="100%">
                            <RadialBarChart cx="50%" cy="60%" innerRadius="60%" outerRadius="100%" barSize={24} data={data} startAngle={180} endAngle={0}>
                                <PolarAngleAxis type="number" domain={[0, 100]} angleAxisId={0} tick={false} />
                                <RadialBar background={{ fill: 'rgba(255, 255, 255, 0.05)' }} dataKey="value" cornerRadius={10} animationDuration={2000} />
                            </RadialBarChart>
                        </ResponsiveContainer>
                        <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/4 text-center">
                            <div className="text-7xl font-black gradient-text glow-gold animate-pulse-glow">{goalPercentage}%</div>
                            <div className="text-gray-400 text-lg mt-2 font-medium">da Meta</div>
                        </div>
                    </div>
                    <div className="flex gap-6 mt-4">
                        <div className="flex items-center gap-2">
                            <div className="w-3 h-3 rounded-full bg-red-500" />
                            <span className="text-gray-400 text-sm">0-33%</span>
                        </div>
                        <div className="flex items-center gap-2">
                            <div className="w-3 h-3 rounded-full bg-yellow-500" />
                            <span className="text-gray-400 text-sm">34-66%</span>
                        </div>
                        <div className="flex items-center gap-2">
                            <div className="w-3 h-3 rounded-full bg-cyan-400" />
                            <span className="text-gray-400 text-sm">67-100%</span>
                        </div>
                    </div>
                </div>
            );
        };

        // FILTER BUTTON
        const FilterButton = ({ icon, label, active, onClick, color = "cyan", index = 0 }) => {
            const colorMap = {
                cyan: { bg: 'from-cyan-500 to-cyan-700', shadow: 'shadow-cyan-500/50' },
                orange: { bg: 'from-orange-500 to-orange-700', shadow: 'shadow-orange-500/50' },
                purple: { bg: 'from-purple-500 to-purple-700', shadow: 'shadow-purple-500/50' },
                pink: { bg: 'from-pink-500 to-pink-700', shadow: 'shadow-pink-500/50' }
            };
            const colors = colorMap[color] || colorMap.cyan;

            return (
                <div className="flex flex-col items-center gap-2 animate-float cursor-pointer" onClick={onClick} style={{ animationDelay: `${index * 0.15}s` }}>
                    <div className={`relative w-20 h-20 rounded-full bg-gradient-to-br ${colors.bg} ${active ? colors.shadow + ' shadow-2xl' : 'shadow-lg'} 
                                     transform transition-all duration-300 hover:scale-110 flex items-center justify-center glass-card ${active ? 'ring-4 ring-white/30' : ''}`}>
                        <div className="text-white text-3xl font-bold">{icon}</div>
                    </div>
                    <div className={`text-sm font-semibold tracking-wide transition-all duration-300 ${active ? 'text-' + color + '-400 scale-110' : 'text-gray-400'}`}>
                        {label}
                    </div>
                </div>
            );
        };

        // WAVE CHART
        const WaveChart = ({ data, title = "HistÃ³rico" }) => {
            const CustomTooltip = ({ active, payload, label }) => {
                if (active && payload && payload.length) {
                    return (
                        <div className="glass-card-strong rounded-lg p-3 border border-purple-500/30">
                            <p className="text-gray-400 text-xs mb-1">{label}</p>
                            <p className="text-purple-400 text-lg font-bold">{payload[0].value.toLocaleString('pt-BR')}</p>
                        </div>
                    );
                }
                return null;
            };

            return (
                <div className="relative w-full h-full">
                    <div className="absolute top-0 left-0 z-10 p-4">
                        <h3 className="text-lg font-bold text-purple-400 tracking-wide uppercase">{title}</h3>
                        <p className="text-gray-500 text-xs mt-1">Ãšltimas 24 horas</p>
                    </div>
                    <ResponsiveContainer width="100%" height="100%">
                        <AreaChart data={data} margin={{ top: 60, right: 30, left: 0, bottom: 20 }}>
                            <defs>
                                <linearGradient id="colorValue" x1="0" y1="0" x2="0" y2="1">
                                    <stop offset="5%" stopColor="#9333EA" stopOpacity={0.8}/>
                                    <stop offset="95%" stopColor="#9333EA" stopOpacity={0.1}/>
                                </linearGradient>
                            </defs>
                            <CartesianGrid strokeDasharray="3 3" stroke="rgba(255, 255, 255, 0.05)" vertical={false} />
                            <XAxis dataKey="time" stroke="rgba(255, 255, 255, 0.3)" tick={{ fill: 'rgba(255, 255, 255, 0.5)', fontSize: 12 }} />
                            <YAxis stroke="rgba(255, 255, 255, 0.3)" tick={{ fill: 'rgba(255, 255, 255, 0.5)', fontSize: 12 }} />
                            <Tooltip content={<CustomTooltip />} />
                            <Area type="monotone" dataKey="value" stroke="#9333EA" strokeWidth={3} fillOpacity={1} fill="url(#colorValue)" />
                        </AreaChart>
                    </ResponsiveContainer>
                </div>
            );
        };

        // APP
        const App = () => {
            const { data, historicalData, loading, error, lastUpdate, getFinanceData, getTotalGoal } = useDashboardData();
            const [activeFilter, setActiveFilter] = useState('all');
            const financeKpis = getFinanceData().slice(0, 4);
            const goalPercentage = getTotalGoal();

            return (
                <div className="relative w-screen h-screen overflow-hidden bg-matte-charcoal">
                    <div className="absolute inset-0 bg-gradient-to-br from-matte-charcoal via-gray-900 to-matte-charcoal" />
                    <div className="absolute top-20 left-20 w-96 h-96 bg-purple-600/10 rounded-full blur-3xl animate-pulse-glow" />
                    <div className="absolute bottom-20 right-20 w-96 h-96 bg-cyan-600/10 rounded-full blur-3xl animate-pulse-glow" style={{ animationDelay: '1s' }} />
                    
                    <div className="relative z-10 flex h-full">
                        <div className="w-80 p-6 flex flex-col justify-center">
                            {financeKpis.map((kpi, index) => <KpiCard key={index} {...kpi} index={index} />)}
                            <div className="mt-4 glass-card rounded-xl p-3">
                                <div className="flex items-center gap-2">
                                    <div className="w-2 h-2 rounded-full bg-red-500 animate-pulse" />
                                    <div className="text-xs text-gray-400">Usando dados mock</div>
                                </div>
                                <div className="text-xs text-gray-500 mt-1">Ãšltima atualizaÃ§Ã£o: {lastUpdate.toLocaleTimeString('pt-BR')}</div>
                            </div>
                        </div>

                        <div className="flex-1 flex flex-col p-6">
                            <div className="text-center mb-4">
                                <h1 className="text-4xl font-black gradient-text tracking-wider mb-2">DASHBOARD EXECUTIVO</h1>
                                <p className="text-gray-400 text-sm">Monitoramento em Tempo Real â€¢ LogÃ­stica & Financeiro</p>
                            </div>

                            <div className="flex-1 flex items-start justify-center">
                                <HeroGauge goalPercentage={goalPercentage} />
                            </div>

                            <div className="flex justify-center gap-8 mb-6">
                                <FilterButton icon="ðŸ“Š" label="Todos" active={activeFilter === 'all'} onClick={() => setActiveFilter('all')} color="cyan" index={0} />
                                <FilterButton icon="ðŸ’°" label="Financeiro" active={activeFilter === 'finance'} onClick={() => setActiveFilter('finance')} color="orange" index={1} />
                                <FilterButton icon="ðŸšš" label="LogÃ­stica" active={activeFilter === 'logistics'} onClick={() => setActiveFilter('logistics')} color="purple" index={2} />
                                <FilterButton icon="ðŸ“ˆ" label="Performance" active={activeFilter === 'performance'} onClick={() => setActiveFilter('performance')} color="pink" index={3} />
                            </div>

                            <div className="h-64 glass-card-strong rounded-2xl overflow-hidden glow-purple">
                                <WaveChart data={historicalData} title="HistÃ³rico Geral" />
                            </div>
                        </div>

                        <div className="w-64 p-6 flex flex-col justify-center gap-4">
                            {data.slice(0, 3).map((item, index) => (
                                <div key={index} className="glass-card-strong rounded-2xl p-4 hover:scale-105 transition-transform duration-300">
                                    <div className="text-xs text-gray-500 uppercase tracking-wider mb-2">{item.kpi_name}</div>
                                    <div className="text-2xl font-bold text-white mb-1">{typeof item.value === 'number' ? item.value.toLocaleString('pt-BR') : item.value}</div>
                                    <div className={`text-xs flex items-center gap-1 ${item.trend > 0 ? 'text-green-400' : 'text-red-400'}`}>
                                        <span>{item.trend > 0 ? 'â†‘' : 'â†“'}</span>
                                        <span>{Math.abs(item.trend).toFixed(1)}%</span>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        // RENDER
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
